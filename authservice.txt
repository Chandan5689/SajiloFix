import axios from 'axios';
import api from '../api/axios'
const API_URL = 'http://127.0.0.1:8000/api/auth/';

const authService = {
    register: async (formData) => {
        try {
            // FormData is passed directly, axios handles the headers
            const response = await axios.post(`${API_URL}register/`, formData, {
                headers: {
                    'Content-Type': 'multipart/form-data'
                }
            });
            
            if (response.data.tokens) {
                localStorage.setItem('access_token', response.data.tokens.access);
                localStorage.setItem('refresh_token', response.data.tokens.refresh);
                localStorage.setItem('user', JSON.stringify(response.data.user));
            }
            
            return response.data;
        } catch (error) {
            throw error.response?.data || error.message;
        }
    },

    login: async (email, password) => {
        try {
            const response = await axios.post(`${API_URL}login/`, { 
                email, 
                password 
            });
            
            if (response.data.access) {
                localStorage.setItem('access_token', response.data.access);
                localStorage.setItem('refresh_token', response.data.refresh);
            }
            
            return response.data;
        } catch (error) {
            throw error.response?.data || error.message;
        }
    },

    logout: () => {
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
        localStorage.removeItem('user');
    },

    getCurrentUser: () => {
        const user = localStorage.getItem('user');
        return user ? JSON.parse(user) : null;
    },

    isAuthenticated: () => {
        return !!localStorage.getItem('access_token');
    }
};

export default authService;










//users/serializers.py

from rest_framework import serializers
from django.contrib.auth import get_user_model
from django.contrib.auth.password_validation import validate_password
from rest_framework.validators import UniqueValidator
from .models import Speciality, Specialization, UserSpeciality, UserSpecialization, Certificate

User = get_user_model()


class SpecialitySerializer(serializers.ModelSerializer):
    class Meta:
        model = Speciality
        fields = ['id', 'name', 'slug']


class SpecializationSerializer(serializers.ModelSerializer):
    speciality_name = serializers.CharField(source='speciality.name', read_only=True)
    
    class Meta:
        model = Specialization
        fields = ['id', 'name', 'speciality_name']


class CertificateSerializer(serializers.ModelSerializer):
    class Meta:
        model = Certificate
        fields = ['id', 'name', 'file', 'uploaded_at']
        read_only_fields = ['uploaded_at']


class RegisterSerializer(serializers.ModelSerializer):
    email = serializers.EmailField(
        required=True,
        validators=[UniqueValidator(queryset=User.objects.all())]
    )
    password = serializers.CharField(
        write_only=True,
        required=True,
        validators=[validate_password],
        style={'input_type': 'password'}
    )
    confirm_password = serializers.CharField(
        write_only=True,
        required=True,
        style={'input_type': 'password'}
    )
    first_name = serializers.CharField(required=True)
    last_name = serializers.CharField(required=True)
    phone_number = serializers.CharField(required=True)
    user_type = serializers.ChoiceField(choices=['find', 'offer'], required=True)
    
    # Optional fields for service providers
    business_name = serializers.CharField(required=False, allow_blank=True)
    years_of_experience = serializers.IntegerField(required=False, allow_null=True)
    service_area = serializers.CharField(required=False, allow_blank=True)
    address = serializers.CharField(required=False, allow_blank=True)
    city = serializers.CharField(required=False, allow_blank=True)
    bio = serializers.CharField(required=False, allow_blank=True)
    profile_picture = serializers.ImageField(required=True, allow_null=False)
    
    # Specialities and Specializations (IDs)
    specialities = serializers.ListField(
        child=serializers.IntegerField(),
        required=False,
        allow_empty=True
        default=list
    )
    specializations = serializers.ListField(
        child=serializers.IntegerField(),
        required=False,
        allow_empty=True
        default=list
    )

    class Meta:
        model = User
        fields = (
            'email', 'password', 'confirm_password', 'first_name', 'last_name',
            'phone_number', 'user_type', 'business_name', 'years_of_experience',
            'service_area', 'address', 'city', 'bio', 'profile_picture',
            'specialities', 'specializations'
        )

    def validate(self, attrs):
        if attrs['password'] != attrs['confirm_password']:
            raise serializers.ValidationError(
                {"password": "Password fields didn't match."}
            )
        
        # If user is offering services, validate specialities
        if attrs.get('user_type') == 'offer':
            specialities = attrs.get('specialities', [])
            if not specialities:
                raise serializers.ValidationError(
                    {"specialities": "Service providers must select at least one speciality."}
                )
        
        return attrs

    def create(self, validated_data):
        validated_data.pop('confirm_password')
        
        # Extract specialities and specializations
        speciality_ids = validated_data.pop('specialities', [])
        specialization_ids = validated_data.pop('specializations', [])
        
        # Create username from email
        username = validated_data['email'].split('@')[0]
        base_username = username
        counter = 1
        while User.objects.filter(username=username).exists():
            username = f"{base_username}{counter}"
            counter += 1
        
        # Create user
        user = User.objects.create_user(
            username=username,
            email=validated_data['email'],
            first_name=validated_data['first_name'],
            last_name=validated_data['last_name'],
            phone_number=validated_data['phone_number'],
            user_type=validated_data['user_type'],
            password=validated_data['password'],
            business_name=validated_data.get('business_name', ''),
            years_of_experience=validated_data.get('years_of_experience', 0),
            service_area=validated_data.get('service_area', ''),
            address=validated_data.get('address', ''),
            city=validated_data.get('city', ''),
            bio=validated_data.get('bio', ''),
            profile_picture=validated_data.get('profile_picture', None)
        )
        
        # Add specialities
        for spec_id in speciality_ids:
            try:
                speciality = Speciality.objects.get(id=spec_id)
                UserSpeciality.objects.create(user=user, speciality=speciality)
            except Speciality.DoesNotExist:
                pass
        
        # Add specializations
        for spec_id in specialization_ids:
            try:
                specialization = Specialization.objects.get(id=spec_id)
                UserSpecialization.objects.create(user=user, specialization=specialization)
            except Specialization.DoesNotExist:
                pass
        
        return user


class UserSerializer(serializers.ModelSerializer):
    specialities = serializers.SerializerMethodField()
    specializations = serializers.SerializerMethodField()
    certificates = CertificateSerializer(many=True, read_only=True)
    profile_picture_url = serializers.SerializerMethodField()
    
    class Meta:
        model = User
        fields = (
            'id', 'email', 'first_name', 'last_name', 'phone_number', 'user_type',
            'profile_picture', 'profile_picture_url', 'address', 'city', 'bio',
            'business_name', 'years_of_experience', 'service_area', 'is_verified',
            'specialities', 'specializations', 'certificates', 'created_at'
        )
        read_only_fields = ('id', 'is_verified', 'created_at')
    
    def get_profile_picture_url(self, obj):
        if obj.profile_picture:
            request = self.context.get('request')
            if request:
                return request.build_absolute_uri(obj.profile_picture.url)
        return None
    
    def get_specialities(self, obj):
        user_specialities = UserSpeciality.objects.filter(user=obj).select_related('speciality')
        return [{'id': us.speciality.id, 'name': us.speciality.name} for us in user_specialities]
    
    def get_specializations(self, obj):
        user_specializations = UserSpecialization.objects.filter(user=obj).select_related('specialization')
        return [{'id': us.specialization.id, 'name': us.specialization.name} for us in user_specializations]










// Register.jsx

import { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import authService from '../../services/authService';
import api from '../../api/axios';

const Register = () => {
  const navigate = useNavigate();
  const [activeStep, setActiveStep] = useState('find');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [successMessage, setSuccessMessage] = useState('');
  const [specialities, setSpecialities] = useState([]);
  const [specializations, setSpecializations] = useState([]);
  const [profilePreview, setProfilePreview] = useState(null);

  const [formData, setFormData] = useState({
    first_name: '',
    last_name: '',
    email: '',
    phone_number: '',
    password: '',
    confirm_password: '',
    user_type: 'find',
    business_name: '',
    years_of_experience: '',
    service_area: '',
    address: '',
    city: '',
    bio: '',
    profile_picture: null,
    specialities: [],
    specializations: []
  });

  const [fieldErrors, setFieldErrors] = useState({});

  // Fetch specialities and specializations
  useEffect(() => {
    const fetchData = async () => {
      try {
        console.log('Fetching specialities and specializations...');
        const [specialitiesRes, specializationsRes] = await Promise.all([
          api.get('/auth/specialities/'),
          api.get('/auth/specializations/')
        ]);
        console.log('Specialities received:', specialitiesRes.data);
        console.log('Specializations received:', specializationsRes.data);
        setSpecialities(specialitiesRes.data);
        setSpecializations(specializationsRes.data);
      } catch (err) {

        console.error('Error fetching data:', err);
        console.error('Error response:', err.response);
        setError('Failed to load specialities. Please refresh the page.');
      }
    };
    fetchData();
  }, []);

  const handleStepChange = (step) => {
    setActiveStep(step);
    setFormData({ ...formData, user_type: step });
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData({ ...formData, [name]: value });
    // Clear field error when user starts typing
    if (fieldErrors[name]) {
      setFieldErrors({ ...fieldErrors, [name]: '' });
    }
  };

  const handleProfilePictureChange = (e) => {
    const file = e.target.files[0];
    if (file) {
      // Validate file size (max 5MB)
      if (file.size > 5 * 1024 * 1024) {
        setFieldErrors({ ...fieldErrors, profile_picture: 'File size must be less than 5MB' });
        return;
      }

      // Validate file type
      if (!file.type.startsWith('image/')) {
        setFieldErrors({ ...fieldErrors, profile_picture: 'Only image files are allowed' });
        return;
      }

      setFormData({ ...formData, profile_picture: file });

      // Create preview
      const reader = new FileReader();
      reader.onloadend = () => {
        setProfilePreview(reader.result);
      };
      reader.readAsDataURL(file);

      // Clear error
      if (fieldErrors.profile_picture) {
        setFieldErrors({ ...fieldErrors, profile_picture: '' });
      }
    }
  };

  const handleSpecialityToggle = (specialityId) => {
    setFormData(prev => {
      const newSpecialities = prev.specialities.includes(specialityId)
        ? prev.specialities.filter(id => id !== specialityId)
        : [...prev.specialities, specialityId];
      return { ...prev, specialities: newSpecialities };
    });
  };

  const handleSpecializationToggle = (specializationId) => {
    setFormData(prev => {
      const newSpecializations = prev.specializations.includes(specializationId)
        ? prev.specializations.filter(id => id !== specializationId)
        : [...prev.specializations, specializationId];
      return { ...prev, specializations: newSpecializations };
    });
  };

  const validateForm = () => {
    const errors = {};

    if (!formData.first_name.trim()) errors.first_name = 'First name is required';
    if (!formData.last_name.trim()) errors.last_name = 'Last name is required';
    if (!formData.email.trim()) errors.email = 'Email is required';
    if (!formData.phone_number.trim()) errors.phone_number = 'Phone number is required';
    if (!formData.password) errors.password = 'Password is required';
    if (!formData.confirm_password) errors.confirm_password = 'Please confirm password';

    if (formData.password && formData.password.length < 8) {
      errors.password = 'Password must be at least 8 characters';
    }

    if (formData.password !== formData.confirm_password) {
      errors.confirm_password = 'Passwords do not match';
    }

    // Validation for service providers
    if (formData.user_type === 'offer') {
      if (formData.specialities.length === 0) {
        errors.specialities = 'Please select at least one speciality';
      }
    }

    setFieldErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setSuccessMessage('');

    if (!validateForm()) {
      setError('Please fix the errors in the form');
      return;
    }

    setLoading(true);

    try {
      // Create FormData for file upload
      const submitData = new FormData();

      // Append all text fields
      Object.keys(formData).forEach(key => {
        if (key === 'profile_picture') {
          // Handle file separately
          if (formData.profile_picture) {
            submitData.append('profile_picture', formData.profile_picture);
          }
        } else if (key === 'specialities') {
          // FIXED: Append each speciality individually with brackets
          formData.specialities.forEach((id, index) => {
            submitData.append(`specialities[${index}]`, id);
          });
        } else if (key === 'specializations') {
          // FIXED: Append each specialization individually with brackets
          formData.specializations.forEach((id, index) => {
            submitData.append(`specializations[${index}]`, id);
          });
        } else if (formData[key] !== '' && formData[key] !== null && formData[key] !== undefined) {
          submitData.append(key, formData[key]);
        }
      });

      // Debug: Log FormData contents
      console.log('FormData contents:');
      for (let pair of submitData.entries()) {
        console.log(pair[0] + ': ' + pair[1]);
      }

      const response = await authService.register(submitData);

      setSuccessMessage('Registration successful! Redirecting...');

      // Redirect based on user type
      setTimeout(() => {
        if (formData.user_type === 'offer') {
          navigate('/provider/dashboard');
        } else {
          navigate('/');
        }
      }, 2000);

    } catch (err) {
      console.error('Registration error:', err);

      if (err.email) {
        setFieldErrors({ ...fieldErrors, email: err.email[0] });
      }
      if (err.password) {
        setFieldErrors({ ...fieldErrors, password: err.password[0] });
      }
      if (err.phone_number) {
        setFieldErrors({ ...fieldErrors, phone_number: err.phone_number[0] });
      }
      if (err.profile_picture) {
        setFieldErrors({ ...fieldErrors, profile_picture: err.profile_picture[0] });
      }
      if (err.specialities) {
        setFieldErrors({ ...fieldErrors, specialities: err.specialities[0] || err.specialities });
      }
      setError(err.detail || err.non_field_errors?.[0] || 'Registration failed. Please try again.');
    } finally {
      setLoading(false);
    }
  };

  const getFilteredSpecializations = () => {
    if (formData.specialities.length === 0) return [];
    return specializations.filter(spec =>
      formData.specialities.includes(spec.speciality)
    );
  };

  return (
    <div className="min-h-screen bg-linear-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-4xl w-full bg-white rounded-2xl shadow-2xl p-8">
        <div className="text-center mb-8">
          <h2 className="text-4xl font-bold text-gray-900 mb-2">Join SajiloFix</h2>
          <p className="text-gray-600">Create your account and get started</p>
        </div>

        {/* User Type Selection */}
        <div className="flex gap-4 mb-8">
          <button
            type="button"
            onClick={() => handleStepChange('find')}
            className={`flex-1 py-2 px-4 rounded-xl font-semibold transition-all ${activeStep === 'find'
                ? 'bg-blue-600 text-white shadow-lg scale-105'
                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
          >
            <div className="text-xl mb-2">üîç</div>
            Find Services
          </button>
          <button
            type="button"
            onClick={() => handleStepChange('offer')}
            className={`flex-1 py-2 px-4 rounded-xl font-semibold transition-all ${activeStep === 'offer'
                ? 'bg-green-600 text-white shadow-lg scale-105'
                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
          >
            <div className="text-xl mb-2">üõ†Ô∏è</div>
            Offer Services
          </button>
        </div>

        {/* Error Messages */}
        {error && (
          <div className="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg">
            <p className="text-red-700">{error}</p>
          </div>
        )}

        {/* Success Message */}
        {successMessage && (
          <div className="mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-lg">
            <p className="text-green-700">{successMessage}</p>
          </div>
        )}

        {/* Registration Form */}
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Profile Picture Upload */}
          <div className="flex flex-col items-center mb-6">
            <div className="relative">
              <div className="w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden border-4 border-gray-300">
                {profilePreview ? (
                  <img src={profilePreview} alt="Profile" className="w-full h-full object-cover" />
                ) : (
                  <span className="text-4xl text-gray-400">üë§</span>
                )}
              </div>
              <label
                htmlFor="profile_picture"
                className="absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full cursor-pointer hover:bg-blue-700 transition-colors"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </label>
              <input
                type="file"
                id="profile_picture"
                name="profile_picture"
                accept="image/*"
                onChange={handleProfilePictureChange}
                className="hidden"
              />
            </div>
            <p className="text-sm text-gray-500 mt-2">Upload profile picture</p>
            {fieldErrors.profile_picture && (
              <p className="text-red-500 text-sm mt-1">{fieldErrors.profile_picture}</p>
            )}
          </div>

          {/* Basic Information */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                First Name *
              </label>
              <input
                type="text"
                name="first_name"
                value={formData.first_name}
                onChange={handleInputChange}
                className={`w-full px-4 py-3 border ${fieldErrors.first_name ? 'border-red-500' : 'border-gray-300'
                  } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent`}
                placeholder="John"
              />
              {fieldErrors.first_name && (
                <p className="text-red-500 text-sm mt-1">{fieldErrors.first_name}</p>
              )}
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Last Name *
              </label>
              <input
                type="text"
                name="last_name"
                value={formData.last_name}
                onChange={handleInputChange}
                className={`w-full px-4 py-3 border ${fieldErrors.last_name ? 'border-red-500' : 'border-gray-300'
                  } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent`}
                placeholder="Doe"
              />
              {fieldErrors.last_name && (
                <p className="text-red-500 text-sm mt-1">{fieldErrors.last_name}</p>
              )}
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Email Address *
            </label>
            <input
              type="email"
              name="email"
              value={formData.email}
              onChange={handleInputChange}
              className={`w-full px-4 py-3 border ${fieldErrors.email ? 'border-red-500' : 'border-gray-300'
                } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent`}
              placeholder="john@example.com"
            />
            {fieldErrors.email && (
              <p className="text-red-500 text-sm mt-1">{fieldErrors.email}</p>
            )}
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Phone Number *
            </label>
            <input
              type="tel"
              name="phone_number"
              value={formData.phone_number}
              onChange={handleInputChange}
              className={`w-full px-4 py-3 border ${fieldErrors.phone_number ? 'border-red-500' : 'border-gray-300'
                } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent`}
              placeholder="+977 98XXXXXXXX"
            />
            {fieldErrors.phone_number && (
              <p className="text-red-500 text-sm mt-1">{fieldErrors.phone_number}</p>
            )}
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Password *
              </label>
              <input
                type="password"
                name="password"
                value={formData.password}
                onChange={handleInputChange}
                className={`w-full px-4 py-3 border ${fieldErrors.password ? 'border-red-500' : 'border-gray-300'
                  } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent`}
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              />
              {fieldErrors.password && (
                <p className="text-red-500 text-sm mt-1">{fieldErrors.password}</p>
              )}
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Confirm Password *
              </label>
              <input
                type="password"
                name="confirm_password"
                value={formData.confirm_password}
                onChange={handleInputChange}
                className={`w-full px-4 py-3 border ${fieldErrors.confirm_password ? 'border-red-500' : 'border-gray-300'
                  } rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent`}
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              />
              {fieldErrors.confirm_password && (
                <p className="text-red-500 text-sm mt-1">{fieldErrors.confirm_password}</p>
              )}
            </div>
          </div>

          {/* Additional fields for service providers */}
          {activeStep === 'offer' && (
            <>
              <div className="border-t pt-6">
                <h3 className="text-xl font-semibold text-gray-900 mb-4">
                  Professional Information
                </h3>

                <div className="space-y-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Business Name
                    </label>
                    <input
                      type="text"
                      name="business_name"
                      value={formData.business_name}
                      onChange={handleInputChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Your Business Name"
                    />
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Years of Experience
                      </label>
                      <input
                        type="number"
                        name="years_of_experience"
                        value={formData.years_of_experience}
                        onChange={handleInputChange}
                        min="0"
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="5"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        City
                      </label>
                      <input
                        type="text"
                        name="city"
                        value={formData.city}
                        onChange={handleInputChange}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Kathmandu"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Service Area
                    </label>
                    <input
                      type="text"
                      name="service_area"
                      value={formData.service_area}
                      onChange={handleInputChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="e.g., Kathmandu Valley"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Address
                    </label>
                    <input
                      type="text"
                      name="address"
                      value={formData.address}
                      onChange={handleInputChange}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Your Address"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Bio / Description
                    </label>
                    <textarea
                      name="bio"
                      value={formData.bio}
                      onChange={handleInputChange}
                      rows="4"
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      placeholder="Tell us about yourself and your services..."
                    />
                  </div>

                  {/* Specialities Selection */}
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Specialities * (Select at least one)
                    </label>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                      {specialities.map(speciality => (
                        <button
                          key={speciality.id}
                          type="button"
                          onClick={() => handleSpecialityToggle(speciality.id)}
                          className={`p-3 rounded-lg border-2 transition-all ${formData.specialities.includes(speciality.id)
                              ? 'border-blue-600 bg-blue-50 text-blue-700'
                              : 'border-gray-300 hover:border-gray-400'
                            }`}
                        >
                          {speciality.name}
                        </button>
                      ))}
                    </div>
                    {fieldErrors.specialities && (
                      <p className="text-red-500 text-sm mt-2">{fieldErrors.specialities}</p>
                    )}
                  </div>

                  {/* Specializations Selection */}
                  {formData.specialities.length > 0 && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Specializations (Based on selected specialities)
                      </label>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-2 max-h-60 overflow-y-auto p-4 border border-gray-200 rounded-lg">
                        {getFilteredSpecializations().map(specialization => (
                          <button
                            key={specialization.id}
                            type="button"
                            onClick={() => handleSpecializationToggle(specialization.id)}
                            className={`p-2 text-sm rounded-lg border transition-all text-left ${formData.specializations.includes(specialization.id)
                                ? 'border-green-600 bg-green-50 text-green-700'
                                : 'border-gray-300 hover:border-gray-400'
                              }`}
                          >
                            {specialization.name}
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </>
          )}

          {/* Submit Button */}
          <button
            type="submit"
            disabled={loading}
            className={`w-full py-4 px-6 rounded-xl font-semibold text-white transition-all ${loading
                ? 'bg-gray-400 cursor-not-allowed'
                : activeStep === 'find'
                  ? 'bg-blue-600 hover:bg-blue-700 shadow-lg hover:shadow-xl'
                  : 'bg-green-600 hover:bg-green-700 shadow-lg hover:shadow-xl'
              }`}
          >
            {loading ? (
              <span className="flex items-center justify-center">
                <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Creating Account...
              </span>
            ) : (
              'Create Account'
            )}
          </button>

          {/* Login Link */}
          <div className="text-center">
            <p className="text-gray-600">
              Already have an account?{' '}
              <Link to="/login" className="text-blue-600 hover:text-blue-700 font-semibold">
                Log In
              </Link>
            </p>
          </div>
        </form>
      </div>
    </div>
  );
};

export default Register;







// Navbar.jsx

import React, { useEffect, useState } from 'react'
import { FaChevronDown } from "react-icons/fa";
import { Link, NavLink, useLocation } from 'react-router-dom';
function Navbar() {
    const [isAuthenticated, setIsAuthenticated] = useState
        (false);
    const location = useLocation();
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    useEffect(() => {
        setIsMenuOpen(false);
    }, [location])

    const navLinks = [
        { name: 'Services', path: '/services' },
        { name: 'How It Works', path: '/howitworks' },
        { name: 'About', path: '/about' },
        { name: 'Contact', path: '/contact' },
    ]
    return (

        <div className='bg-gray-50'>
            <header className='bg-white sticky top-0 shadow-md z-50'>
                <div className='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'>
                    <div className='flex justify-between items-center h-16'>
                        <div className='flex items-center'>
                            <Link to="/">
                                <h1 className="text-2xl font-bold text-green-600 cursor-pointer hover:text-green-700 transition-colors duration-300 font-['Pacifico,sans-serif,cursive']">
                                    SajiloFix
                                </h1>
                            </Link>

                        </div>

                        {/* Desktop navigation */}
                        <nav className='hidden md:flex    space-x-8'>
                            {navLinks.map((link) => (
                                <NavLink to={link.path} key={link.name} className={`text-gray-700 hover:text-green-600 font-medium cursor-pointer ${location.pathname === link.path ? 'text-green-600' : 'text-gray-700'}`} >
                                    {link.name}
                                </NavLink>
                            ))}
                        </nav>
                        <div className=' hidden md:flex items-center space-x-4'>
                            {isAuthenticated ? (
                                <div className='relative'>
                                    <button

                                        className="flex items-center space-x-3 text-gray-700 hover:text-green-600 cursor-pointer"
                                    >
                                        <div className="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                            <span>Avatar</span>
                                        </div>
                                        <div className="hidden md:block text-left">
                                            <p className="text-sm font-medium text-gray-900">user.name</p>
                                            <p className="text-xs text-gray-600">user.email</p>
                                        </div>
                                        <FaChevronDown className='text-xs' />
                                    </button>
                                </div>) : (

                                <div className='flex space-x-6'>
                                    <button

                                        className="text-gray-700 hover:text-green-600 font-medium cursor-pointer whitespace-nowrap"
                                    >
                                        <Link to="/login">
                                            Login
                                        </Link>
                                    </button>
                                    <button

                                        className="bg-green-600 text-white px-6 py-2 font-medium hover:bg-green-700 transition-colors cursor-pointer whitespace-nowrap rounded-xl"
                                    >
                                        <Link to="/register">
                                            Sign Up
                                        </Link>
                                    </button>
                                </div>
                            )}


                        </div>

                        {/* Mobile menu button toggle */}
                        <button onClick={() => setIsMenuOpen(!isMenuOpen)} className='md:hidden text-gray-500 focus:outline-none cursor-pointer'>
                            <svg
                                className={`w-6 h-6 text-gray-900`}
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                {isMenuOpen ? (
                                    <path
                                        strokeLinecap="round"
                                        strokeLinejoin="round"
                                        strokeWidth={2}
                                        d="M6 18L18 6M6 6l12 12"
                                    />
                                ) : (
                                    <path
                                        strokeLinecap="round"
                                        strokeLinejoin="round"
                                        strokeWidth={2}
                                        d="M4 6h16M4 12h16M4 18h16"
                                    />
                                )}
                            </svg>
                        </button>
                    </div>
                    {/* Mobile navigation menu */}
                    {isMenuOpen && (
                        <div className='flex flex-col md:hidden transition-all duration-500 ease-in py-4'>
                            <div className='flex flex-col space-y-8'>
                                {navLinks.map((link) => (
                                    <NavLink to={link.path} key={link.name} className={`text-gray-700 hover:text-green-600 font-medium cursor-pointer ${location.pathname === link.path ? 'text-green-600' : 'text-gray-700'}`}>
                                        {link.name}
                                    </NavLink>
                                ))}
                            </div>
                            <div className=' flex flex-col space-y-4 pb-4'>
                                {isAuthenticated ? (
                                    <div className='relative'>
                                        <button

                                            className="flex items-center space-x-3 text-gray-700 hover:text-green-600 cursor-pointer"
                                        >
                                            <div className="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                                <span>Avatar</span>
                                            </div>
                                            <div className="hidden md:block text-left">
                                                <p className="text-sm font-medium text-gray-900">user.name</p>
                                                <p className="text-xs text-gray-600">user.email</p>
                                            </div>
                                            <FaChevronDown className='text-xs' />
                                        </button>
                                    </div>) : (

                                    <div className='flex flex-col space-y-6'>
                                        <button

                                            className="text-gray-700 hover:text-green-600 font-medium cursor-pointer whitespace-nowrap"
                                        >
                                            <Link to="/login">
                                                Login
                                            </Link>
                                        </button>
                                        <button

                                            className="bg-green-600 text-white px-6 py-2 font-medium hover:bg-green-700 transition-colors cursor-pointer whitespace-nowrap rounded-xl"
                                        >
                                            <Link to="/register">
                                                Sign Up
                                            </Link>
                                        </button>
                                    </div>
                                )}

                            </div>
                        </div>

                    )}
                </div>
            </header>
        </div>

    )
}

export default Navbar




"""
class RegisterSerializer(serializers.ModelSerializer):
    # Serializer for user registration
    email = serializers.EmailField(
        required=True,
        validators=[UniqueValidator(queryset=User.objects.all())]
    )
    password = serializers.CharField(
        write_only=True,
        required=True,
        validators=[validate_password],
        style={'input_type': 'password'}
    )
    confirm_password = serializers.CharField(
        write_only=True,
        required=True,
        style={'input_type': 'password'}
    )
    first_name = serializers.CharField(required=True)
    last_name = serializers.CharField(required=True)
    phone_number = serializers.CharField(required=True,max_length=14,
        min_length=10,
        validators=[
            RegexValidator(
                regex=r'^98\d{8}|^97\d{8}$',
                message="Phone number must be 10 digits starting with 98 or 97 (e.g., 9812345678)"
            )]
    )
    user_type = serializers.ChoiceField(choices=['find', 'offer'], required=True)
    
    # Optional fields for service providers
    business_name = serializers.CharField(required=False, allow_blank=True)
    years_of_experience = serializers.IntegerField(required=False, allow_null=True)
    service_area = serializers.CharField(required=False, allow_blank=True)
    address = serializers.CharField(required=False, allow_blank=True)
    city = serializers.CharField(required=False, allow_blank=True)
    bio = serializers.CharField(required=False, allow_blank=True)
    profile_picture = serializers.ImageField(required=True, allow_null=False)
    
    # Specialities and Specializations (IDs) - now handled as lists
    specialities = serializers.ListField(
        child=serializers.IntegerField(),
        required=False,
        allow_empty=True,
        default=list
        
    )
    specializations = serializers.ListField(
        child=serializers.IntegerField(),
        required=False,
        allow_empty=True,
        default=list
        
    )

     # Certificates - handled as file list
    certificates = serializers.ListField(
        child=serializers.FileField(),
        required=False,
        allow_empty=True,
        write_only=True
    )

    class Meta:
        model = User
        fields = (
            'email', 'password', 'confirm_password', 'first_name', 'last_name',
            'phone_number', 'user_type', 'business_name', 'years_of_experience',
            'service_area', 'address', 'city', 'bio', 'profile_picture',
            'specialities', 'specializations','certificates'
        )

    def to_internal_value(self, data):
        
        # Handle FormData array format like specialities[0], specialities[1]
        
        # Convert FormData array format to Python lists
        if hasattr(data, 'getlist'):
            # DRF request.data for FormData
            specialities = []
            specializations = []
            certificates = []
            
            # Collect all specialities[*] keys
            for key in data.keys():
                if key.startswith('specialities['):
                    try:
                        specialities.append(int(data[key]))
                    except (ValueError, TypeError):
                        pass
                elif key.startswith('specializations['):
                    try:
                        specializations.append(int(data[key]))
                    except (ValueError, TypeError):
                        pass
                elif key.startswith('certificates['):
                    # Get certificate file
                    cert_file = data.get(key)
                    if cert_file:
                        certificates.append(cert_file)
            
            # Create a mutable copy
            mutable_data = data.copy()
            
            # Remove individual array items
            keys_to_remove = [k for k in mutable_data.keys() if k.startswith('specialities[') or k.startswith('specializations[') or k.startswith('certificates[')]
            for key in keys_to_remove:
                mutable_data.pop(key)
            
            # Add lists
            if specialities:
                mutable_data.setlist('specialities', specialities)
            if specializations:
                mutable_data.setlist('specializations', specializations)
            if certificates:
                mutable_data.setlist('certificates', certificates)

            data = mutable_data
        
        return super().to_internal_value(data)

    def validate(self, attrs):
        if attrs['password'] != attrs['confirm_password']:
            raise serializers.ValidationError(
                {"password": "Password fields didn't match."}
            )
        
        phone_number = attrs.get('phone_number')
        if User.objects.filter(phone_number=phone_number).exists():
            raise serializers.ValidationError(
                {"phone_number": "This phone number is already registered."}
            )
        
        
        # If user is offering services, validate specialities
        if attrs.get('user_type') == 'offer':
            specialities = attrs.get('specialities', [])
            if not specialities or len(specialities) == 0:
                raise serializers.ValidationError(
                    {"specialities": "Service providers must select at least one speciality."}
                )
        
        if attrs.get('user_type') == 'find':
            attrs['specialities'] = []
            attrs['specializations'] = []
        
        return attrs

    def create(self, validated_data):
        validated_data.pop('confirm_password')
        
        # Extract specialities and specializations
        speciality_ids = validated_data.pop('specialities', [])
        specialization_ids = validated_data.pop('specializations', [])
        certificate_files = validated_data.pop('certificates', [])
        
        # Create username from email
        username = validated_data['email'].split('@')[0]
        base_username = username
        counter = 1
        while User.objects.filter(username=username).exists():
            username = f"{base_username}{counter}"
            counter += 1
        
        # Create user
        user = User.objects.create_user(
            username=username,
            email=validated_data['email'],
            first_name=validated_data['first_name'],
            last_name=validated_data['last_name'],
            phone_number=validated_data['phone_number'],
            user_type=validated_data['user_type'],
            password=validated_data['password'],
            business_name=validated_data.get('business_name', ''),
            years_of_experience=validated_data.get('years_of_experience', 0),
            service_area=validated_data.get('service_area', ''),
            address=validated_data.get('address', ''),
            city=validated_data.get('city', ''),
            bio=validated_data.get('bio', ''),
            profile_picture=validated_data.get('profile_picture', None)
        )
        
        # Add specialities
        for spec_id in speciality_ids:
            try:
                speciality = Speciality.objects.get(id=spec_id)
                UserSpeciality.objects.create(user=user, speciality=speciality)
            except Speciality.DoesNotExist:
                pass
        
        # Add specializations
        for spec_id in specialization_ids:
            try:
                specialization = Specialization.objects.get(id=spec_id)
                UserSpecialization.objects.create(user=user, specialization=specialization)
            except Specialization.DoesNotExist:
                pass

        # Add certificates
        for cert_file in certificate_files:
            Certificate.objects.create(
                user=user,
                name=cert_file.name,
                file=cert_file
            )
        
        return user
"""





"""
class RegisterView(generics.CreateAPIView):
    queryset = User.objects.all()
    permission_classes = (AllowAny,)
    serializer_class = RegisterSerializer

    def create(self, request, *args, **kwargs):
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        user = serializer.save()
        
        # Generate JWT tokens
        refresh = RefreshToken.for_user(user)
        
        # Get user data with context for absolute URLs
        user_serializer = UserSerializer(user, context={'request': request})
        
        return Response({
            'user': user_serializer.data,
            'tokens': {
                'refresh': str(refresh),
                'access': str(refresh.access_token),
            },
            'message': 'User registered successfully'
        }, status=status.HTTP_201_CREATED)
"""



//PhoneVerification.jsx

import React, { useState, useRef, useEffect } from 'react';
import { RecaptchaVerifier, signInWithPhoneNumber } from 'firebase/auth';
import { auth } from '../../config/firebase';
import { useFirebaseAuth } from '../../context/FirebaseAuthContext';
import api from '../../api/axios';

function PhoneVerification({ userType, location, onComplete }) {
    const { getIdToken } = useFirebaseAuth();
    const [phoneNumber, setPhoneNumber] = useState('');
    const [otp, setOtp] = useState('');
    const [step, setStep] = useState(1); // 1: Enter phone, 2: Verify OTP
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');
    const [verificationId, setVerificationId] = useState(null);

    // reCAPTCHA container ref and setup on mount
    const recaptchaRef = useRef(null);

    const setupRecaptcha = () => {
        if (typeof window === 'undefined') return;
        const containerId = 'recaptcha-container';
        if (!document.getElementById(containerId)) return;

        if (!window.recaptchaVerifier) {
            try {
                // For this Firebase SDK version the constructor expects the Auth instance
                // as the first argument: `new RecaptchaVerifier(auth, container, params)`.
                window.recaptchaVerifier = new RecaptchaVerifier(
                    auth,
                    containerId,
                    {
                        size: 'invisible',
                        callback: () => {},
                    }
                );
            } catch (initErr) {
                console.error('RecaptchaVerifier init failed:', initErr);
                // fallback: try container-only signature
                try {
                    window.recaptchaVerifier = new RecaptchaVerifier(
                        containerId,
                        {
                            size: 'invisible',
                            callback: () => {},
                        }
                    );
                } catch (fallbackErr) {
                    console.error('RecaptchaVerifier fallback init failed:', fallbackErr);
                }
            }
        }
    };

    useEffect(() => {
        setupRecaptcha();

        return () => {
            if (window.recaptchaVerifier) {
                try {
                    window.recaptchaVerifier.clear();
                } catch (e) {
                    // ignore clear errors
                }
                window.recaptchaVerifier = null;
            }
        };
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, []);

    // Step 1: Send OTP
    const handleSendOTP = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        // Validate phone number (accept 98 or 97)
        if (!/^(98|97)\d{8}$/.test(phoneNumber)) {
            setError('Phone number must be 10 digits starting with 98 or 97');
            setLoading(false);
            return;
        }

        try {
            setupRecaptcha();
            const appVerifier = window.recaptchaVerifier;
            const phoneNumberWithCountryCode = `+977${phoneNumber}`;

            const confirmationResult = await signInWithPhoneNumber(
                auth,
                phoneNumberWithCountryCode,
                appVerifier
            );

            setVerificationId(confirmationResult);
            setStep(2);
            setError('');
        } catch (err) {
            console.error('Error sending OTP:', err);
            setError(err.message || 'Failed to send OTP. Please try again.');

            // Reset reCAPTCHA safely
            if (window.recaptchaVerifier) {
                try {
                    window.recaptchaVerifier.clear();
                } catch (e) {
                    // ignore clear errors
                }
                window.recaptchaVerifier = null;
            }
        } finally {
            setLoading(false);
        }
    };

    // Step 2: Verify OTP
    const handleVerifyOTP = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        try {
            // Verify OTP with Firebase
            const result = await verificationId.confirm(otp);
            const firebaseUser = result.user;

            // Get Firebase ID token
            const idToken = await getIdToken();

            // Send to Django backend
            await api.post(
                'auth/verify-phone/',
                {
                    phone_number: phoneNumber,
                    firebase_uid: firebaseUser.uid,
                },
                {
                    headers: {
                        Authorization: `Bearer ${idToken}`,
                    },
                }
            );

            // Update user type and location in Django
            await api.post(
                'auth/update-user-type/',
                {
                    user_type: userType,
                    location: location,
                },
                {
                    headers: {
                        Authorization: `Bearer ${idToken}`,
                    },
                }
            );

            // Success! Call completion callback
            onComplete();
        } catch (err) {
            console.error('Error verifying OTP:', err);
            setError(err.response?.data?.error || err.message || 'Invalid OTP. Please try again.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <div className="min-h-screen bg-linear-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4">
            <div className="max-w-md w-full bg-white rounded-2xl shadow-2xl p-8">
                <div className="text-center mb-8">
                    <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span className="text-4xl">üì±</span>
                    </div>
                    <h2 className="text-3xl font-bold text-gray-900 mb-2">
                        Verify Phone Number
                    </h2>
                    <p className="text-gray-600">
                        We'll send you a verification code
                    </p>
                </div>

                {error && (
                    <div className="mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg">
                        <p className="text-red-700 text-sm">{error}</p>
                    </div>
                )}

                {step === 1 && (
                    <form onSubmit={handleSendOTP} className="space-y-6">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number (Nepal)
                            </label>
                            <div className="flex">
                                <span className="inline-flex items-center px-4 bg-gray-100 border border-r-0 border-gray-300 rounded-l-lg text-gray-600">
                                    +977
                                </span>
                                <input
                                    type="tel"
                                    value={phoneNumber}
                                    onChange={(e) => setPhoneNumber(e.target.value)}
                                    placeholder="9812345678"
                                    maxLength="10"
                                    className="flex-1 px-4 py-3 border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    required
                                />
                            </div>
                            <p className="mt-1 text-xs text-gray-500">
                                Enter 10 digits starting with 98
                            </p>
                        </div>

                        <div id="recaptcha-container" ref={recaptchaRef}></div>

                        <button
                            type="submit"
                            disabled={loading}
                            className="w-full py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 transition-colors"
                        >
                            {loading ? (
                                <span className="flex items-center justify-center">
                                    <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Sending Code...
                                </span>
                            ) : (
                                'Send Verification Code'
                            )}
                        </button>
                    </form>
                )}

                {step === 2 && (
                    <form onSubmit={handleVerifyOTP} className="space-y-6">
                        <div className="text-center mb-6">
                            <p className="text-gray-600">
                                We sent a 6-digit code to
                            </p>
                            <p className="text-lg font-semibold text-gray-900 mt-1">
                                +977 {phoneNumber}
                            </p>
                            <button
                                type="button"
                                onClick={() => setStep(1)}
                                className="text-blue-600 text-sm mt-2 hover:underline"
                            >
                                Change number
                            </button>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2 text-center">
                                Enter Verification Code
                            </label>
                            <input
                                type="text"
                                value={otp}
                                onChange={(e) => setOtp(e.target.value.replace(/\D/g, ''))}
                                placeholder="000000"
                                maxLength="6"
                                className="w-full px-4 py-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-center text-3xl tracking-widest font-semibold"
                                required
                            />
                        </div>

                        <button
                            type="submit"
                            disabled={loading || otp.length !== 6}
                            className="w-full py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 disabled:bg-gray-400 transition-colors"
                        >
                            {loading ? (
                                <span className="flex items-center justify-center">
                                    <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Verifying...
                                </span>
                            ) : (
                                'Verify & Continue'
                            )}
                        </button>

                        <button
                            type="button"
                            onClick={handleSendOTP}
                            className="w-full text-blue-600 hover:text-blue-700 text-sm font-medium"
                            disabled={loading}
                        >
                            Resend Code
                        </button>
                    </form>
                )}

                <div className="mt-6 text-center">
                    <p className="text-xs text-gray-500">
                        By continuing, you agree to our Terms of Service and Privacy Policy
                    </p>
                </div>
            </div>
        </div>
    );
}

export default PhoneVerification;